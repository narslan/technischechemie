% !TEX encoding   = UTF-8
% !TEX program    = LuaLaTeX
% !TEX spellcheck = de_DE
\documentclass[a4paper]{article}
\usepackage{fontspec}
\usepackage[usenames,dvipsnames]{color}
\usepackage{siunitx}
\usepackage[german]{babel}

\usepackage{pgfplots}
\usepackage{pgfplotstable}
\pgfplotsset{compat=1.13}
\usepgfplotslibrary{units}


\usepackage{luacode}
\definecolor{skyblue1}{rgb}{0.447,0.624,0.812}
\definecolor{scarletred1}{rgb}{0.937,0.161,0.161}
\definecolor{chameleon1}{rgb}{0.541,0.886,0.204}
%\usepackage{helvet}
\usepackage[landscape]{geometry}
\usepackage{unicode-math}

\usepackage[landscape]{geometry}
%\setmainfont{Ubuntu}
\setmainfont{TeX Gyre Heros}

\setmathfont{TeX Gyre Heros}
\usepackage{fancyhdr}
\pagestyle{fancy}


\rhead{ Gruppe 24}
\setlength{\headheight}{15pt}
\pagenumbering{gobble}
\lhead{Absorptionsspektren von Kupferkonzentrationen 0 mg/L, 1 mg/L, 2 mg/L und 4 mg/L }

\begin{luacode*}

local unpack=table.unpack

function drawD()
  local files={}
  local colors={}
  local files = {'iso.csv','iso2.csv','iso3.csv','iso4.csv'}
    local colors = {'blue','orange','red','teal','black','green'}

for filei=1,#files do


    tex.sprint("\\addplot[".."no markers,"..colors[filei].."] coordinates{")


    for line in io.lines(files[filei]) do
           local s, e = line:find("%s+", 1)
            local y=tonumber(line:sub(e))
           local x=tonumber(line:sub(1,e))
        if type(x)  then

        tex.sprint("("..x..","..y..")")

        end
   end

     tex.sprint("};")
              tex.sprint("\\addlegendentry{"..files[filei].."}")

     end

end


\end{luacode*}
\newcommand\addplotCHIpf{\directlua{drawD()}}
\pgfplotsset{
    standard/.style={
     xlabel= Wellenl√§nge, % Set the labels
    ylabel= Absorption ,
    x unit= \si{\nano\meter} , % Set the respective units
    y label style={at={(axis description cs:-0.2,.5)},anchor=south},
    x tick label style={rotate=90,anchor=east},
    x label style={at={(axis description cs:0.5,-.2)},anchor=south},
    legend style={draw=none,legend pos=outer north east,legend cell align=left},
     minor x tick num={10},
     minor y tick num={10},
        }
}
\begin{document}
\begin{tikzpicture}[scale=1.4,font=\sffamily]

\begin{axis}[standard]
  \addplotCHIpf
\end{axis}
\end{tikzpicture}
\par
%\tabellenwerte
\end{document}
