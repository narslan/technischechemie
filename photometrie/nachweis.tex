% !TEX encoding   = UTF-8
% !TEX program    = LuaLaTeX
% !TEX spellcheck = de_DE
\documentclass[a4paper]{article}
\usepackage{fontspec}
\usepackage[usenames,dvipsnames]{color}
\usepackage{siunitx}
\usepackage[german]{babel}

\usepackage{pgfplots}
\usepackage{pgfplotstable}
\pgfplotsset{compat=newest}
\usepgfplotslibrary{units}
\usepgfplotslibrary{colorbrewer}

\usepackage{tabularx}
\usepackage{luacode}
\definecolor{skyblue1}{rgb}{0.447,0.624,0.812}
\definecolor{scarletred1}{rgb}{0.937,0.161,0.161}
\definecolor{chameleon1}{rgb}{0.541,0.886,0.204}
%\usepackage{helvet}
\usepackage[landscape]{geometry}
\usepackage{unicode-math}

\usepackage[landscape]{geometry}
%\setmainfont{Ubuntu}
\setmainfont{TeX Gyre Heros}

\setmathfont{TeX Gyre Heros}
\usepackage{fancyhdr}
\pagestyle{fancy}

\rhead{ Gruppe 24}
\setlength{\headheight}{15pt}
\pagenumbering{gobble}
\lhead{Absorptionsspektren von Kupferkonzentrationen 0 mg/L, 0.25, 0.5,  1 mg/L, 2 mg/L }

\begin{luacode*}

local unpack=table.unpack

function drawD()
  local files={}
  local colors={}
  --local files = {'1.TXT','2.TXT','3.TXT','H2OA.TXT','MAX.TXT','BASELINE.TXT'}
  --  local files = {'450.TXT','451.TXT','452.TXT','453.TXT','BASELINE.TXT','BASELINE.TXT'}
    local colors = {'blue','orange','red','teal','black','green','violet','pink','green'}
   -- local shifty = {-0.176238 ,  -0.217737 , -0.211587 ,  -0.182053 , -0.223418,0}
 --local files = {'MAX.TXT'}
local files = {'450.TXT','451.TXT','452.TXT','453.TXT','M.TXT'}
for filei=1,#files do

    local wavec = 400
    tex.sprint("\\addplot[".."no markers,"..colors[filei].."] coordinates{")


    for line in io.lines(files[filei]) do
        if type(line)  then
        local coord= math.pow(10,line) -1
        --table.insert(lines,line)
        tex.sprint("("..wavec..","..coord..")")
        wavec=wavec+0.85
        end
   end

     tex.sprint("};")
              tex.sprint("\\addlegendentry{"..files[filei].."}")

     end

end


\end{luacode*}
\newcommand\addplotCHIpf{\directlua{drawD()}}
\pgfplotscreateplotcyclelist{color list}{%
red,blue,black,yellow,brown,teal,orange,violet,cyan,green!70!black,magenta,gray}
\pgfplotsset{
    standard/.style={
        axis x line=middle,
    axis y line=middle,
     xlabel= Wellenl√§nge, % Set the labels
    ylabel= Absorption ,
    x unit= \si{\nano\meter} , % Set the respective units
    y label style={at={(axis description cs:-0.2,.5)},rotate=90,anchor=south},
    x tick label style={rotate=90,anchor=east},
    x label style={at={(axis description cs:0.5,-.2)},anchor=south},
    legend style={draw=none,legend pos=outer north east,legend cell align=left},
     minor x tick num={10},
     minor y tick num={10},
     ymax = 0.3
        }
}
\begin{document}
\begin{tikzpicture}[scale=1.4,font=\sffamily]

\begin{axis}[standard]
  \addplotCHIpf
\end{axis}
\end{tikzpicture}
\par
\begin{table}[ht!]
  \centering
 \begin{tabularx}{\textwidth}{XXXXXXXXX}
$y_1^2$ & $y_2^2$ & $y_3^2$ &$y_4^2$ & $x^2$ & $xy_1$ & $xy_2$ &$xy_3$ &$xy_4$\\
\hline
0.005644& 0.005645 &0.005685 &0.005713 &0.000000 &-0.000000& -0.000000 &-0.000000 & -0.000000\\
0.001618& 0.001653 &0.001669 &0.001646 &0.062500 &-0.010056& 0.010165  &-0.010213 & -0.010142\\
0.000242& 0.000237 &0.000238 &0.000267 &0.250000 &0.007783 &0.007694   &0.007719  & 0.008168 \\
0.005667& 0.005658 &0.005609 &0.005619 &1.000000 &0.075279 &0.075220   &0.074893  & 0.074960 \\
0.023571& 0.023571 &0.023528 &0.023593 &4.000000 &0.307054 &0.307054   &0.306778  & 0.307202 \\
$\sum x:$3.750000& $\sum y$:0.594900& &summexx:&5.312500&summeyy:&0.689163&summexy:1.539558 & \\
m:0.309807 & b:-0.028344 &&&&&&&
\end{tabularx}
   \renewcommand\thetable{2}
  \caption{}
\end{table}


%\tabellenwerte
\end{document}
